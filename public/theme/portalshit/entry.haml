.article.section
  .header
    - if @entry.type == Post
      .prevnext
        - if @entry.next
          %span.prev
            = link_to "<< #{truncate(@entry.next.title, length: 25)}", @entry.next.link, rel: :prev, title: @entry.next.title
        - if @entry.prev
          %span.next
            = link_to "#{truncate(@entry.prev.title, length: 25)} >>", @entry.prev.link, rel: :next, title: @entry.prev.title
    %h2.title= link_to @entry.title, @entry.link
    .meta
      = l(@entry.created_at, format: '%Y年%m月%d日 (%a)')
      - if @entry.category
        == | @#{link_to @entry.category.title, "/category/#{@entry.category.slug}/"}

  .body
    ~ @entry.body

  - if referrers.present?
    .referrers
      %h3 この記事を参照している記事
      %ul
        - referrers.each do |referrer|
          %li
            = link_to referrer.title, referrer.link
            %span.created_at= l(referrer.created_at, format: '%Y年%m月%d日 (%a)')
  - if @entry.similar_entries.present?
    .similar
      %h3 この記事に似ている記事
      %ul
        - @entry.similarities.all(order: [:score.desc]).each do |similarity|
          - similar = similarity.similar_entry
          %li
            = link_to similar.title, similar.link
            %span.created_at= l(similar.created_at, format: '%Y年%m月%d日 (%a)')

  .footer
    = @entry.tags_to_html
    .comment== #{link_to "#{t('comments')} (#{@entry.comments.size})", "#{@entry.link}#comment_form"}
    .created_at== #{l @entry.created_at, format: :long}
    - if logged_in?
      .edit= link_to t('edit'), @entry.edit_link

  .article-bottom
    = partial :advertisement
    = partial :related

%ul.comments
  - @entry.comments.reverse.each do |comment|
    %li.comment{id: "comment-#{comment.id}"}
      %ul.meta
        %li.gravatar= image_tag gravatar_image_url comment.email
        %li.name= link_to comment.name, comment.homepage, unless: comment.homepage.blank?
        %li.created_at= l comment.created_at, format: :long
      .body= hbr comment.body
= partial 'comment'
